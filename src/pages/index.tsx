import Header from "@/components/header";
import Banner from "@/components/banner";
import Instructions from "@/components/instructions";
import Head from "next/head";
import About from "@/components/about";
import { GetServerSideProps, InferGetServerSidePropsType } from "next/types";
import Cards from "@/assets/cards.png";
import TreesLeft from "@/assets/trees-left.png";
import TreesRight from "@/assets/trees-right.png";
import Image from "next/image";
import { getSession, useSession } from "next-auth/react";
import Location from "@/components/location";
import Contribute from "@/components/contribute";
import { SignInModal } from "@/components/signInModal";
import clientPromise from "@/lib/mongodb";

function Home({ isConnected, user }: InferGetServerSidePropsType<typeof getServerSideProps>) {
  const { data: session } = useSession();
  console.log();
  return (
    <>
      <Head>
        <title>Minha Festa</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/Logo load.png" />
      </Head>
      <main className="main">
        <div className={isConnected ? "main_db-true" : "main_db-false"}></div>
        <Header user={session?.user} />
        <Banner />
        <About />
        <Instructions />
        <Contribute />
        <Location />
        <SignInModal />
        <Image className="cardsBlackJack" src={Cards} alt="cards" />
        <Image className="TreesLeft" src={TreesLeft} alt="TreesLeft" />
        <Image className="TreesRight" src={TreesRight} alt="TreesRight" />
      </main>
    </>
  );
}
export const getServerSideProps: GetServerSideProps = async (context) => {
  const session = await getSession(context);
  try {
    await clientPromise;
    return {
      props: { isConnected: true },
    };
  } catch (e) {
    console.error(e);
    return {
      props: { isConnected: false },
    };
  }
};
export default Home;
